#!/usr/bin/env node
module.exports = {
  zip: 'VSCode-darwin-stable.zip',
  run: 'Visual Studio Code.app/Contents/MacOS/Electron',
  node_modules_parent: 'Visual Studio Code.app/Contents/Resources/app'
};

if (process.mainModule === module) {
  switch (process.env.npm_lifecycle_event) {
    case 'prepublish':
    case 'prepublishOnly':
      renameSudir('node_modules', 'x-node_modules');
      break;
    case 'postinstall':
      renameSudir('x-node_modules', 'node_modules');
      break;

    default:
      var child_process = require('child_process');
      child_process.spawnSync(module.exports.run, process.argv.slice(2));
      break;
  }
}

function renameSudir(from, to) {
  var fs = require('fs');
  var path = require('path');
  var fullFrom = path.resolve(__dirname, module.exports.node_modules_parent, from),
    fullTo = path.resolve(__dirname, module.exports.node_modules_parent, to);

  if (fs.existsSync(fullTo)) {
    console.log(process.env.npm_lifecycle_event + ' already renamed to ' + path.resolve(__dirname, from));
  }
  else {
    console.log(process.env.npm_lifecycle_event + ' rename ' + path.resolve(__dirname, from));
    fs.renameSync(
      path.resolve(__dirname, module.exports.node_modules_parent, from),
      path.resolve(__dirname, module.exports.node_modules_parent, to)
    );
  }
}